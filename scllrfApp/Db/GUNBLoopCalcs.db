#! Generated by VisualDCT v2.6.1280
#! DBDSTART
#! DBDEND

# Macros:
# P - Gun or buncher prefix GUN:GUNB:100: or ACCL:GUNB:455:
#
# 1300RATIO - what to divide 1300 MHz by to get output frequency, 1 for buncher, 7 for gun
#
# ALIAS_N - for aliasing to Apex names, 1 for gun, 2 for buncher

#record(calcout, "$(P)LASER_FREQ_Hz")
#{
#alias( "llrf$(N):laser_freq_Hz" )
#field(INPA, "$(P)LASER_FREQ")
#field(INPB, "-13.6239")
#field(CALC, "A*B")
#}
#record(ao, "$(P)PRC:WAVE_SAMP_PER_W")
#{
#field(FLNK, "$(P)WAVE_SHIFT_CALC")
#}
#
# We do this partly in firmware, partly in GUNBExtra.cpp
#record(calcout, "$(P)WAVE_SHIFT_CALC")
#{
#alias( "llrf$(N):wave_shift_calc" )
#field(INPA, "$(P)PRC:WAVE_SAMP_PER_W")
#field(INPB, "0.602059991327962")
##log10(4)
## change by hg for 100MHz -> 102MHz Osc CIC_PERIOD change from 14 to 22
##field(INPC,"5349.87755102041") #2^20/(14^2)
#field(INPC, "2166.479338842975")
##2^20/(22^2)
#field(CALC, "MIN(8-FLOOR(LOG(C/A^2)/B),7)")
#field(OUT, "$(P)PRC:WAVE_SHIFT_W PP")
#}
record(ao, "$(P)PH2_4_STATIC") {
}

record(calcout, "$(P)PHASE_DIFF") {
alias("llrf$(ALIAS_N):phase_diff")
field(INPA, "$(P)PH2_4_MEAN_DEGREE")
field(INPB, "$(P)PH2_4_STATIC PP")
field(INPD, "360000")
# 360/2^32
field(CALC, "((((A-B+540)*1000)%D)/1000-180)")
field(SCAN, ".2 second")
}

record(bo, "$(P)FREQ_LOOP_CLOSE") {
alias("llrf$(ALIAS_N):freq_loop_close")
field(ZNAM, "Off")
field(ONAM, "On")
}

record(ao, "$(P)FREQ_LOOP_GAIN") {
#       field(FLNK, "$(P)FREQ_SHIFT")
field(VAL, "$(FTGAIN=-0.0011121)")
	info( autosaveFields, "VAL")
}

#record(calcout, "$(P)FREQ_SHIFT") {
#field(INPA, "$(P)PRC:DDSA_PHSTEP_H_R NPP MS")
#field(INPB, "$(P)PHASE_DIFF")
#field(INPC, "$(P)RF_MASTER")
#field(INPE, "$(P)FREQ_LOOP_GAIN PP")
#field(CALC, "(A+(ABS(B)<40?B:0)*E*C)")
#	field( SDIS, "$(P)FREQ_LOOP_CLOSE")
#	field( DISV, "0")
#field(SCAN, ".2 second")
#field(OUT, "$(P)PRC:DDSA_PHSTEP_H_W PP")
#	field(EGU, "Hz")
#}

record(calc, "$(P)FREQ_NOMINAL")
{
field(INPB, "$(1300RATIO)")
# The 13xx is good for the gun, not buncher. Use freq divider macro.
field(CALC, "1300e6/B")
field(EGU, "Hz")
}

record(calc, "$(P)FREQ_OFFSET")
{
field(INPA, "$(P)PRC:DDSA_PHSTEP_H_R CP MS")
# The 13xx is good for the gun, not buncher. Use freq divider macro.
field(CALC, "A*1320e6/(7*2^20)")
field(EGU, "Hz")
}

record(calc, "$(P)FREQ_CAV") {
alias("llrf$(ALIAS_N):freq_cav")
field(INPA, "$(P)PRC:DDSA_PHSTEP_H_R CP MS")
field(INPB, "$(1300RATIO)")
# The 13xx is good for the gun, not buncher. Use freq divider macro.
field(CALC, "1300e6/B+A*1320e6/(7*2^20)")
field(EGU, "Hz")
}

record(calcout, "$(P)DETUNE_GOOD") {
field(INPA, "$(P)DECAY_STRENGTH")
field(INPB, "$(P)DECAY_FIT_STDDEV")
field(INPE, "$(P)PACT_LAST_N_STD")
field(INPC, "50")
field(INPD, "3000")
field(INPE, "$(P)PACT_LAST_N_STD")
field(INPF, "$(P)DETUNE_MODE")
field(INPG, "1")
field(CALC, "(A>C)&&(B<D)&&F?1:(E<G)")
field(SCAN, ".2 second")
}

record(calcout, "$(P)CALC_NEW_PHSTEP_H") {
field(INPA, "$(P)PRC:DDSA_PHSTEP_H_W MS")
field(INPB, "$(P)DFACT CP")
# Check # with Gang
# 2^20/(1300e6/7)
field(INPC, "$(P)FREQ_LOOP_GAIN")
field(CALC, "A+B*C")
	field( SDIS, "$(P)DETUNE_GOOD")
	field( DISV, "0")
}

record(ai, "$(P)PH2_4_MEAN") {
field(FLNK, "$(P)PH2_4_MEAN_DEGREE")
}

record(calcout, "$(P)PH2_4_MEAN_DEGREE") {
field(INPA, "$(P)PH2_4_MEAN")
field(INPB, "8.38190317153931e-08")
#360/2^32
#field(CALC, "A*B")
# The above is from Apex. I think for SLAC it should be:
field(INPC, "$(P)CAV2:PMEAN")
field(INPD, "$(P)PRC:RFS2B:PMEAN")
field(CALC, "A-B")
field(EGU, "deg")
}

record(calcout, "$(P)READY_TO_TUNE") {
field(INPA, "$(P)DETUNE_GOOD CP")
field(INPB, "$(P)FREQ_LOOP_CLOSE CP")
field(CALC, "(A==1)&(B==0)")
}

record(bo, "$(P)BT_DO_FREQ_CORRECTION") {
alias("llrf$(ALIAS_N):bt_do_freq_correction")
field(FLNK, "$(P)DO_FREQ_CORRECTION")
field(ZNAM, "Off")
field(ONAM, "On")
# Momentary button sort of action, and reset before DO_... executes.
field(HIGH, "0.7")
field(OUT, "$(P)FREQ_LOOP_CLOSE")
}

record(seq, "$(P)DO_FREQ_CORRECTION") {
	field(SELL, "$(P)READY_TO_TUNE")
	field(SELM, "All")
	field(DOL1, "$(P)CALC_NEW_PHSTEP_H PP")
	field(LNK1, "$(P)PRC:DDSA_PHSTEP_H_W PP")
	field(DOL2, "$(P)CALC_NEW_PHSTEP_H PP")
	field(LNK2, "$(P)RFS1:DDSA_PHSTEP_H_W PP")
	field(DOL3, "$(P)CALC_NEW_PHSTEP_H PP")
	field(LNK3, "$(P)RFS2:DDSA_PHSTEP_H_W PP")
	field(DOL4, "$(P)PH2_4_MEAN_DEGREE PP")
	field(LNK4, "$(P)PH2_4_STATIC PP")
	field(DLY4, "1")
	field( SDIS, "$(P)FREQ_LOOP_CLOSE")
	field( DISV, "0")
	field(SCAN, ".2 second")
}

#record(ao,"$(P)PRC:PULSE_LENGTH_W")
#{
#    field(LINR, "SLOPE")
#    field(ESLO, "9.790209e-3")
#    field(EGU,  "uS")
#}
# SLAC is doing something similar in GUNBMisc.template
#record(ao,"$(P)PRC:SET_ILOOP_AMP_W")
#{
#field(FLNK,"$(P)CALC_SET_ILOOP_RE PP")
#}
#record(ao,"$(P)PRC:SET_ILOOP_PH_W")
#{
#field(PREC, 4)
#field(FLNK,"$(P)CALC_SET_ILOOP_RE PP")
#}
#record(calcout,"$(P)CALC_SET_ILOOP_RE")
#{
#field(INPA,"$(P)PRC:SET_ILOOP_AMP_W")
#field(INPB,"$(P)PRC:SET_ILOOP_PH_W")
#        field(CALC,"(A*COS(B))")
##field(SCAN,".2 second")
##field(TPRO,1)
#field(OUT,"$(P)PRC:SET_ILOOP_RE_W PP")
#field(FLNK,"$(P)CALC_SET_ILOOP_IM PP")
#}
#record(calcout,"$(P)CALC_SET_ILOOP_IM")
#{
#field(INPA,"$(P)PRC:SET_ILOOP_AMP_W")
#field(INPB,"$(P)PRC:SET_ILOOP_PH_W")
#        field(CALC,"(A*SIN(B))")
##field(SCAN,".2 second")
##field(TPRO,1)
#field(OUT,"$(P)PRC:SET_ILOOP_IM_W PP")
#}
#record(calcout,"$(P)CALC_SET_ILOOP_AMP")
#{
#field(INPA,"$(P)PRC:SET_ILOOP_RE_W")
#field(INPB,"$(P)PRC:SET_ILOOP_IM_W")
#field(CALC,"(SQRT(A*A+B*B))")
##field(SCAN,".2 second")
##field(TPRO,1)
#field(OUT,"$(P)PRC:SET_ILOOP_AMP_W NPP")
#field(FLNK,"$(P)CALC_SET_ILOOP_PH PP")
#field(PINI,1)
#}
#record(calcout,"$(P)CALC_SET_ILOOP_PH")
#{
#field(INPA,"$(P)PRC:SET_ILOOP_RE_W")
#field(INPB,"$(P)PRC:SET_ILOOP_IM_W")
#field(CALC,"(ATAN2(A,B))")
##field(SCAN,".2 second")
##field(TPRO,1)
#field(OUT,"$(P)PRC:SET_ILOOP_PH_W NPP")
#field(FLNK,"$(P)CALC_SET_PLOOP_RE")
#field(PINI,1)
#}
#record(ao,"$(P)PRC:SET_ILOOP_RE_W")
#{
#field(FLNK,"$(P)CALC_SET_ILOOP_AMP PP")
#}
#record(ao,"$(P)PRC:SET_ILOOP_IM_W")
#{
#field(FLNK,"$(P)CALC_SET_ILOOP_AMP PP")
#}
#record(ao, "$(P)PRC:GAIN_ILOOP_AMP_W") {
#field(FLNK, "$(P)CALC_GAIN_ILOOP_RE PP")
#}
#
#record(ao, "$(P)PRC:GAIN_ILOOP_PH_W") {
#field(PREC, "4")
#field(FLNK, "$(P)CALC_GAIN_ILOOP_RE PP")
#}
#
#record(calcout, "$(P)CALC_GAIN_ILOOP_RE") {
## attached to hardware register
#field(INPA, "$(P)PRC:GAIN_ILOOP_AMP_W")
#field(INPB, "$(P)PRC:GAIN_ILOOP_PH_W")
#field(CALC, "(A*COS(B))")
##field(SCAN,".2 second")
#field(OUT, "$(P)PRC:GAIN_ILOOP_RE_W PP")
#field(FLNK, "$(P)CALC_GAIN_ILOOP_IM PP")
#}
#
#record(calcout, "$(P)CALC_GAIN_ILOOP_IM") {
## attached to hardware register
#field(INPA, "$(P)PRC:GAIN_ILOOP_AMP_W")
#field(INPB, "$(P)PRC:GAIN_ILOOP_PH_W")
#field(CALC, "(A*SIN(B))")
##field(SCAN,".2 second")
#field(OUT, "$(P)PRC:GAIN_ILOOP_IM_W PP")
#field(FLNK, "$(P)CALC_GAINP_ALPHA PP")
#}
#
#record(calcout, "$(P)CALC_GAIN_ILOOP_AMP") {
#field(INPA, "$(P)PRC:GAIN_ILOOP_RE_W")
#field(INPB, "$(P)PRC:GAIN_ILOOP_IM_W")
#field(CALC, "(SQRT(A*A+B*B))")
##field(SCAN,".2 second")
#field(OUT, "$(P)PRC:GAIN_ILOOP_AMP_W NPP")
#field(FLNK, "$(P)CALC_GAIN_ILOOP_PH PP")
#field(PINI, "YES")
#}
#
#record(calcout, "$(P)CALC_GAIN_ILOOP_PH") {
#field(INPA, "$(P)PRC:GAIN_ILOOP_RE_W")
#field(INPB, "$(P)PRC:GAIN_ILOOP_IM_W")
#field(CALC, "(ATAN2(B,A))")
##field(SCAN,".2 second")
#field(OUT, "$(P)PRC:GAIN_ILOOP_PH_W NPP")
#field(PINI, "YES")
#}
#
#record(ao, "$(P)PRC:GAIN_ILOOP_RE_W") {
#field(FLNK, "$(P)CALC_GAIN_ILOOP_AMP PP")
#	info( autosaveFields, "VAL")
#}
#
#record(ao, "$(P)PRC:GAIN_ILOOP_IM_W") {
#field(FLNK, "$(P)CALC_GAIN_ILOOP_AMP PP")
#	info( autosaveFields, "VAL")
#}

#record(ao, "$(P)PRC:GAINP_AMP_W") {
#field(FLNK, "$(P)CALC_GAINP_ALPHA PP")
#	info( autosaveFields, "VAL")
#}
#
#record(ao, "$(P)PRC:GAINP_PH_W") {
#field(PREC, "4")
#field(FLNK, "$(P)CALC_GAINP_ALPHA PP")
#	info( autosaveFields, "VAL")
#}

## for Gang: Is GAINP_PH_OFFSET_W the equivalent of PH_DELAY?
#record(ao, "$(P)PRC:GAINP_PH_OFFSET_W") {
#field(PREC, "4")
#field(FLNK, "$(P)CALC_GAINP_ALPHA PP")
#field(VAL, "-0.772")
## determined by simulation, see close_loop_proc.py
#field(PINI, "YES")
#}

record(ao, "$(P)PRC:DDSA_PHSTEP_H_W") {
# Using equivalent values from Apex.
# Their center value is 191,677, ours is 0.
field(HIHI, "4106.0")
field(HIGH, "3080.0")
field(LOW, "-3080.0")
field(LOLO, "-4106.0")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}


record (calc, "$(P)DFACT" )
{
	field( INPA, "$(P)CW_DETUNE NPP MS" )
	field( INPB, "$(P)CAV1:DECAY_STRENGTH NPP MS")
	field( INPC, "$(P)CAV2:DECAY_STRENGTH NPP MS")
	field( INPD, "$(P)CAV1:DECAY_CONSTANT_B NPP MS")
	field( INPE, "$(P)CAV2:DECAY_CONSTANT_B NPP MS")
	field( INPF, "$(P)DETUNE_MODE NPP MS")
	# If pulsed, use the signal with greater decay strength (cleaner)
	# Otherwise, use the CW calculation.
	field( CALC, "F?(B>C?D:E):A")
	field(EGU, "Hz")
}

# This record keeps ADES, the closed loop setpoint,
# synchronized with the cavity amplitude, during open loop operation
record ( acalcout, "$(P)AACT_DECAY" )
{
	field( INAA, "$(P)CAV1:DECAY_AWF CP MS" )
	field( INBB, "$(P)CAV2:DECAY_AWF NPP MS" )
	field( INPA, "0.9" ) # Equivalent of SMOO field in ai records
	field( INPB, "GUN:GUNB:100:ACTIVE_PROBE")
## The equation is odd because the record wasn't working with AA[0]
	field( CALC, "(ISNAN(VAL)?0:VAL)*A+(1-A)*(B=1?AMAX(AA[0,1]):AMAX(BB[0,1]))" ) # Use this if we want 2 probe max.
#	field( CALC, "VAL*A+(1-A)*AMAX(AA[0,1])" )
#	field( OUT, "$(P)ADES PP")
#	field( OOPT, "On Change")
#	field( PINI, "YES" )
## This should be inactive when loop is CLOSED
#	field( SDIS, "$(P)PRC:CLOSE_LOOP_W")
#	field( DISV, "1")
	field( NELM, "1")
	field( NUSE, "1")
	field(EGU, "sqrt(W)")
	info( autosaveFields, "VAL")
}


record ( acalcout, "$(P)PACT_DECAY" )
{
	field( INAA, "$(P)CAV1:DECAY_PWF CP MS" )
	field( INBB, "$(P)CAV2:DECAY_PWF NPP MS" )
	field( INPA, "0.9" ) # Equivalent of SMOO field in ai records
	field( INPB, "$(P)ACTIVE_PROBE")
	field( CALC, "(ISNAN(VAL)?0:VAL)*A+(1-A)*(B=1?AMAX(AA[0,1]):AMAX(BB[0,1]))" )
#	field( OUT, "$(P)PDES PP")
#	field( OOPT, "On Change")
#	field( PINI, "YES" )
## This should be inactive when loop is CLOSED
## The equation is odd because the record wasn't working with AA[0]
#	field( SDIS, "$(P)PRC:CLOSE_LOOP_W")
#	field( DISV, "1")
	field( NELM, "1")
	field( NUSE, "1")
	field(EGU, "deg")
	info( autosaveFields, "VAL")
}

record (bo, "$(P)RFCTRL" )
{
	field( DESC, "Hook for RF control sequence" )
	field( ONAM, "On" )
	field( ZNAM, "OFF" )
	field( OUT, "$(P)CALC_RFCTRL PP" )
	field( FLNK,
}

record(calcout, "$(P)CALC_RFCTRL") {
field(INPA, "$(P)RFCTRL")
field(OUT, "$(P)SWITCH_RFCTRL PP")
field(CALC, "A+1")
	info( autosaveFields, "VAL")
}

record(seq, "$(P)SWITCH_RFCTRL") {
field(SELM, "Specified")
#field(SELM,"All")
field(SELL, "$(P)CALC_RFCTRL")
field(LNK1, "$(P)RFCTRL_OFF PP")
field(LNK2, "$(P)RFCTRL_ON PP")
}

record(seq, "$(P)RFCTRL_OFF") {
field(SELM, "All")
# Set gains to 0 so there's no jump
field(DO1, "0")
field(LNK1, "$(P)AOPEN PP")
field(DO2, "0")
field(LNK2, "$(P)ADES PP")
}

record(seq, "$(P)RFCTRL_ON") {
field(SELM, "All")
# Set gains to 0 so there's no jump
#TBD
}

record (mbbi, "$(P)RFMODE" )
{
	field( DESC, "Hook for RF control sequence" )
}

# Amplitude/phase loop proportional gain
record( ao, "$(P)AP_KP")
{
	field( FLNK, "$(P)AP_KP_Sync")
	info( autosaveFields, "VAL")

}
record( ao, "$(P)AP_KP_Sync")
{
	field( DOL,  "$(P)AP_KP")
	field( OMSL, "closed_loop")
	field( OUT,  "$(P)PRC:GAINP_BETA_W PP")
}
# Amplitude/phase loop integral gain
record( ao, "$(P)AP_KI")
{
	field( FLNK, "$(P)AP_KI_Sync")
	info( autosaveFields, "VAL")

}
record( ao, "$(P)AP_KI_Sync")
{
	field( DOL,  "$(P)AP_KI")
	field( OMSL, "closed_loop")
	field( OUT,  "$(P)PRC:GAINP_ALPHA_W PP")
}

# Defined in GUNBRegisters, adding autosave here.
record(ao, "$(P)FDBKSEL_W")
{
	info( autosaveFields, "VAL")
}

record(bo, "$(P)BT_CLOSELOOP") {
field(FLNK, "$(P)CALC_CLOSELOOP")
field(ZNAM, "Off")
field(ONAM, "On")
}

record(calc, "$(P)CALC_CLOSELOOP") {
field(INPA, "$(P)BT_CLOSELOOP")
field(FLNK, "$(P)SWITCH_CLOSELOOP")
field(CALC, "A?2:1")
	info( autosaveFields, "VAL")
}

record(seq, "$(P)SWITCH_CLOSELOOP") {
field(SELM, "Specified")
#field(SELM,"All")
field(SELL, "$(P)CALC_CLOSELOOP")
field(LNK1, "$(P)DO_OPENLOOP PP")
field(LNK2, "$(P)DO_CLOSELOOP PP")
}

record(seq, "$(P)DO_CLOSELOOP") {
field(SELM, "All")
# Set gains to 0 so there's no jump
field(DO1, "0")
field(LNK1, "$(P)PRC:GAINP_BETA_W PP")
field(DO2, "0")
field(LNK2, "$(P)PRC:GAINP_ALPHA_W PP")
field(DOL3, "$(P)AACT_DECAY")
field(LNK3, "$(P)ADES PP")
field(DOL4, "$(P)PACT_DECAY")
field(LNK4, "$(P)PDES PP")
# Close the loop
field(DLY5, "0.5")
field(DO5, "1")
field(LNK5, "$(P)PRC:CLOSE_LOOP_W PP")
# Set proportional, then integral gain
field(DLY6, "0.2")
field(DOL6, "$(P)AP_KP")
field(LNK6, "$(P)PRC:GAINP_BETA_W PP MS")
field(DOL7, "$(P)AP_KI")
field(LNK7, "$(P)PRC:GAINP_ALPHA_W PP MS")
}

######xxxxx tHIS MAY BE CAUSING PROBLEMS
#record(calcout, "$(P)PRC:CALC_FDBK_CLIPV_W") {
#field(INPA, "$(P)ADES CP")
#field(INPB, "$(P)PRC:FDBK_CLIPV_W.DRVH")
#field(CALC, "max(-B,min(1.15*A,B))")
#field(OUT, "$(P)PRC:FDBK_CLIPV_W PP")
#}

record(seq, "$(P)DO_OPENLOOP") {
field(SELM, "All")
# Set gains to 0 to stop output from changing
field(DO1, "0")
field(LNK2, "$(P)PRC:GAINP_ALPHA_W PP")
field(DO2, "0")
field(LNK2, "$(P)PRC:GAINP_BETA_W PP")
# Allow 0.2s for VOUT*FALL stable value readbacks
field(DLY3, "0.2")
field(DO3, "1")
field(LNK3, "$(P)SOURCE_RE_Sync.PROC")
field(DO4, "1")
field(LNK4, "$(P)SOURCE_IM_Sync.PROC")
#field(DLY5, "0.2")
#field(DO5, "0")
#field(LNK5, "$(P)PRC:FDBK_CLIPV_W PP")
field(DLY6, "0.2")
field(DO6, "0")
field(LNK6, "$(P)PRC:CLOSE_LOOP_W PP")
}

record(calc, "$(P)CALC_OPEN_SOURCE_RE") {
field(INPA, "$(P)PRC:FDBK_CLIPV_W")
field(CALC, "floor(A/1.15+0.5)")
}

record(ai, "$(P)PRC:ADC1_MIN_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC2_MIN_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC3_MIN_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC4_MIN_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC1_MAX_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC2_MAX_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC3_MAX_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ai, "$(P)PRC:ADC4_MAX_R") {
field(HIHI, "32700")
field(HIGH, "32500")
field(LOW, "-32500")
field(LOLO, "-32700")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(ao, "$(P)PRC:DECAY_SAMP_PER_W") {
field(HIHI, "4")
field(HIGH, "3")
field(LOW, "1")
field(LOLO, "0")
field(HHSV, "MAJOR")
field(HSV, "MINOR")
field(LSV, "MINOR")
field(LLSV, "MAJOR")
}

record(calc, "$(P)SYSTEM_HEALTH_1") {
field(INPA, "$(P)PRC:ADC1_MAX_R CP MS")
field(INPB, "$(P)PRC:ADC2_MAX_R CP MS")
field(INPC, "$(P)PRC:ADC3_MAX_R CP MS")
field(INPD, "$(P)PRC:ADC4_MAX_R CP MS")
field(INPE, "$(P)PRC:ADC1_MIN_R CP MS")
field(INPF, "$(P)PRC:ADC2_MIN_R CP MS")
field(INPG, "$(P)PRC:ADC3_MIN_R CP MS")
field(INPH, "$(P)PRC:ADC4_MIN_R CP MS")
field(INPI, "$(P)PRC:DECAY_SAMP_PER_W CP MS")
field(INPJ, "$(P)PRC:CH_KEEP_W CP MS")
field(INPK, "$(P)PRC:DDSA_PHSTEP_H_W CP MS")
}

#record(calc, "$(P)SYSTEM_HEALTH_CMP_1")
#{
#field(INPA, "$(P)PRC:DECAY_SAMP_PER_W")
#}
record(bi, "$(P)PRC:RF_MASTER")
{
	field(INP, "$(P)PRC:PERMITSTATUS_LSBITS_R.BC CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}
record(bi, "$(P)RFS1:RF_MASTER")
{
	field(INP, "$(P)RFS1:PERMITSTATUS_LSBITS_R.BC CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}
record(bi, "$(P)RFS2:RF_MASTER")
{
	field(INP, "$(P)RFS2:PERMITSTATUS_LSBITS_R.BC CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}
record(calc, "$(P)RF_MASTER_CALC")
{
field(INPA, "$(P)PRC:RF_MASTER CP MS")
field(INPB, "$(P)RFS1:RF_MASTER CP MS")
field(INPC, "$(P)RFS2:RF_MASTER CP MS")
field(CALC, "A&&B&&C")
field(LOLO, 0)
field(LLSV, "MAJOR")
}


record(bi, "$(P)RF_MASTER") {
#Garth adding the desrciption
field(DESC, "Master control to enable/disable RF")
field(INP, "$(P)RF_MASTER_CALC CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}

record(bi, "$(P)PRC:RF_PERMIT")
{
	field(INP, "$(P)PRC:PERMITSTATUS_LSBITS_R.B0 CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}
record(bi, "$(P)RFS1:RF_PERMIT")
{
	field(INP, "$(P)RFS1:PERMITSTATUS_LSBITS_R.B0 CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}
record(bi, "$(P)RFS2:RF_PERMIT")
{
	field(INP, "$(P)RFS2:PERMITSTATUS_LSBITS_R.B0 CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}
record(calc, "$(P)RF_PERMIT_CALC")
{
field(INPA, "$(P)PRC:RF_PERMIT CP MS")
field(INPB, "$(P)RFS1:RF_PERMIT CP MS")
field(INPC, "$(P)RFS2:RF_PERMIT CP MS")
field(CALC, "A&&B&&C")
field(LOLO, 0)
field(LLSV, "MAJOR")
}


record(bi, "$(P)RF_PERMIT") {
#Garth adding the desrciption
field(DESC, "PERMIT control to enable/disable RF")
field(INP, "$(P)RF_PERMIT_CALC CP MS")
	field(ZNAM, "Fault")
	field(ZSV, "MAJOR")
	field(ONAM, "Ok")
}

record(ao, "$(P)MASK_BOUNDARY_RESET") {
	info( autosaveFields, "VAL")
}

# If MASK_BOUNDARY_RESET is true, don't change PULSE_BOUNDARY
# If RF_MASTER is on and we're pulsed, set PULSE_BOUNDARY to rising edge,
# Otherwise set PULSE BOUNDARY to free running
# Apex has reasons for needing this, LCLS doesn't
record(calcout, "$(P)BOUNDARY_RESET_CALC") {
	field(INPA, "$(P)RF_MASTER")
	field(INPB, "$(P)PRC:RF_GO_W")
	field(INPE, "$(P)PRC:REP_PERIOD_W CP MS")
	field(INPF, "$(P)PRC:PULSE_LENGTH_W CP MS")
	field(CALC, "(F<E)?2:0")
	field(OUT, "$(P)SET_BOUNDARY_RESETS PP")
	field(SDIS, "$(P)MASK_BOUNDARY_RESET")
	field( DISV, "1")
}
record( dfanout, "$(P)SET_BOUNDARY_RESETS") {

	field( OUTA, "$(P)PRC:PULSE_BOUNDARY_W PP" )
	field( OUTB, "$(P)RFS1:PULSE_BOUNDARY_W PP" )
	field( OUTC, "$(P)RFS2:PULSE_BOUNDARY_W PP" )
}

#! Further lines contain data used by VisualDCT
#! View(1596,0,0.8)
#! Record("$(P)PH2_4_STATIC",3335,353,0,0,"$(P)PH2_4_STATIC")
#! Field("$(P)PH2_4_STATIC.VAL",16777215,0,"$(P)PH2_4_STATIC.VAL")
#! Record("$(P)PHASE_DIFF",3372,110,0,0,"$(P)PHASE_DIFF")
#! Field("$(P)PHASE_DIFF.INPA",16777215,0,"$(P)PHASE_DIFF.INPA")
#! Link("$(P)PHASE_DIFF.INPA","$(P)PH2_4_MEAN_DEGREE.VAL")
#! Field("$(P)PHASE_DIFF.INPB",16777215,0,"$(P)PHASE_DIFF.INPB")
#! Link("$(P)PHASE_DIFF.INPB","$(P)PH2_4_STATIC.VAL")
#! Field("$(P)PHASE_DIFF.VAL",16777215,0,"$(P)PHASE_DIFF.VAL")
#! Record("$(P)FREQ_LOOP_CLOSE",2674,175,0,0,"$(P)FREQ_LOOP_CLOSE")
#! Field("$(P)FREQ_LOOP_CLOSE.VAL",16777215,1,"$(P)FREQ_LOOP_CLOSE.VAL")
#! Record("$(P)FREQ_LOOP_GAIN",2687,266,0,0,"$(P)FREQ_LOOP_GAIN")
#! Field("$(P)FREQ_LOOP_GAIN.VAL",16777215,1,"$(P)FREQ_LOOP_GAIN.VAL")
#! Record("$(P)FREQ_SHIFT",2994,33,0,0,"$(P)FREQ_SHIFT")
#! Field("$(P)FREQ_SHIFT.INPA",16777215,0,"$(P)FREQ_SHIFT.INPA")
#! Link("$(P)FREQ_SHIFT.INPA","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Field("$(P)FREQ_SHIFT.INPB",16777215,1,"$(P)FREQ_SHIFT.INPB")
#! Link("$(P)FREQ_SHIFT.INPB","$(P)PHASE_DIFF.VAL")
#! Field("$(P)FREQ_SHIFT.INPC",16777215,0,"$(P)FREQ_SHIFT.INPC")
#! Link("$(P)FREQ_SHIFT.INPC","$(P)RF_MASTER.VAL")
#! Field("$(P)FREQ_SHIFT.INPD",16777215,0,"$(P)FREQ_SHIFT.INPD")
#! Link("$(P)FREQ_SHIFT.INPD","$(P)FREQ_LOOP_CLOSE.VAL")
#! Field("$(P)FREQ_SHIFT.INPE",16777215,0,"$(P)FREQ_SHIFT.INPE")
#! Link("$(P)FREQ_SHIFT.INPE","$(P)FREQ_LOOP_GAIN.VAL")
#! Field("$(P)FREQ_SHIFT.OUT",16777215,0,"$(P)FREQ_SHIFT.OUT")
#! Link("$(P)FREQ_SHIFT.OUT","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Record("$(P)FREQ_CAV",2719,1233,0,0,"$(P)FREQ_CAV")
#! Field("$(P)FREQ_CAV.INPA",16777215,0,"$(P)FREQ_CAV.INPA")
#! Link("$(P)FREQ_CAV.INPA","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Field("$(P)FREQ_CAV.INPB",16777215,1,"$(P)FREQ_CAV.INPB")
#! Field("$(P)FREQ_CAV.INPC",16777215,1,"$(P)FREQ_CAV.INPC")
#! Record("$(P)DETUNE_GOOD",2701,384,0,0,"$(P)DETUNE_GOOD")
#! Field("$(P)DETUNE_GOOD.INPA",16777215,1,"$(P)DETUNE_GOOD.INPA")
#! Field("$(P)DETUNE_GOOD.INPB",16777215,1,"$(P)DETUNE_GOOD.INPB")
#! Field("$(P)DETUNE_GOOD.VAL",16777215,0,"$(P)DETUNE_GOOD.VAL")
#! Record("$(P)CALC_NEW_PHSTEP_H",3018,769,0,0,"$(P)CALC_NEW_PHSTEP_H")
#! Field("$(P)CALC_NEW_PHSTEP_H.INPA",16777215,0,"$(P)CALC_NEW_PHSTEP_H.INPA")
#! Link("$(P)CALC_NEW_PHSTEP_H.INPA","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Field("$(P)CALC_NEW_PHSTEP_H.INPB",16777215,1,"$(P)CALC_NEW_PHSTEP_H.INPB")
#! Field("$(P)CALC_NEW_PHSTEP_H.VAL",16777215,0,"$(P)CALC_NEW_PHSTEP_H.VAL")
#! Record("$(P)PH2_4_MEAN",3365,753,0,0,"$(P)PH2_4_MEAN")
#! Field("$(P)PH2_4_MEAN.VAL",16777215,0,"$(P)PH2_4_MEAN.VAL")
#! Field("$(P)PH2_4_MEAN.FLNK",16777215,0,"$(P)PH2_4_MEAN.FLNK")
#! Link("$(P)PH2_4_MEAN.FLNK","$(P)PH2_4_MEAN_DEGREE")
#! Record("$(P)PH2_4_MEAN_DEGREE",3372,485,0,0,"$(P)PH2_4_MEAN_DEGREE")
#! Field("$(P)PH2_4_MEAN_DEGREE.INPA",16777215,0,"$(P)PH2_4_MEAN_DEGREE.INPA")
#! Link("$(P)PH2_4_MEAN_DEGREE.INPA","$(P)PH2_4_MEAN.VAL")
#! Field("$(P)PH2_4_MEAN_DEGREE.VAL",16777215,0,"$(P)PH2_4_MEAN_DEGREE.VAL")
#! Field("$(P)PH2_4_MEAN_DEGREE.INPC",16777215,1,"$(P)PH2_4_MEAN_DEGREE.INPC")
#! Field("$(P)PH2_4_MEAN_DEGREE.INPD",16777215,1,"$(P)PH2_4_MEAN_DEGREE.INPD")
#! Record("$(P)READY_TO_TUNE",2721,577,0,0,"$(P)READY_TO_TUNE")
#! Field("$(P)READY_TO_TUNE.INPA",16777215,0,"$(P)READY_TO_TUNE.INPA")
#! Link("$(P)READY_TO_TUNE.INPA","$(P)DETUNE_GOOD.VAL")
#! Field("$(P)READY_TO_TUNE.INPB",16777215,0,"$(P)READY_TO_TUNE.INPB")
#! Link("$(P)READY_TO_TUNE.INPB","$(P)FREQ_LOOP_CLOSE.VAL")
#! Field("$(P)READY_TO_TUNE.VAL",16777215,1,"$(P)READY_TO_TUNE.VAL")
#! Record("$(P)BT_DO_FREQ_CORRECTION",3015,387,0,0,"$(P)BT_DO_FREQ_CORRECTION")
#! Field("$(P)BT_DO_FREQ_CORRECTION.FLNK",16777215,0,"$(P)BT_DO_FREQ_CORRECTION.FLNK")
#! Link("$(P)BT_DO_FREQ_CORRECTION.FLNK","$(P)DO_FREQ_CORRECTION")
#! Record("$(P)DO_FREQ_CORRECTION",3017,479,0,0,"$(P)DO_FREQ_CORRECTION")
#! Field("$(P)DO_FREQ_CORRECTION.SELL",16777215,0,"$(P)DO_FREQ_CORRECTION.SELL")
#! Link("$(P)DO_FREQ_CORRECTION.SELL","$(P)READY_TO_TUNE.VAL")
#! Field("$(P)DO_FREQ_CORRECTION.DOL1",16777215,0,"$(P)DO_FREQ_CORRECTION.DOL1")
#! Link("$(P)DO_FREQ_CORRECTION.DOL1","$(P)CALC_NEW_PHSTEP_H.VAL")
#! Field("$(P)DO_FREQ_CORRECTION.LNK1",16777215,0,"$(P)DO_FREQ_CORRECTION.LNK1")
#! Link("$(P)DO_FREQ_CORRECTION.LNK1","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Field("$(P)DO_FREQ_CORRECTION.DOL2",16777215,1,"$(P)DO_FREQ_CORRECTION.DOL2")
#! Link("$(P)DO_FREQ_CORRECTION.DOL2","$(P)PH2_4_MEAN_DEGREE.VAL")
#! Field("$(P)DO_FREQ_CORRECTION.LNK2",16777215,1,"$(P)DO_FREQ_CORRECTION.LNK2")
#! Link("$(P)DO_FREQ_CORRECTION.LNK2","$(P)PH2_4_STATIC.VAL")
#! Record("$(P)PRC:GAIN_ILOOP_AMP_W",443,64,0,0,"$(P)PRC:GAIN_ILOOP_AMP_W")
#! Field("$(P)PRC:GAIN_ILOOP_AMP_W.FLNK",16777215,1,"$(P)PRC:GAIN_ILOOP_AMP_W.FLNK")
#! Link("$(P)PRC:GAIN_ILOOP_AMP_W.FLNK","$(P)CALC_GAIN_ILOOP_RE")
#! Field("$(P)PRC:GAIN_ILOOP_AMP_W.VAL",16777215,1,"$(P)PRC:GAIN_ILOOP_AMP_W.VAL")
#! Record("$(P)PRC:GAIN_ILOOP_PH_W",463,245,0,0,"$(P)PRC:GAIN_ILOOP_PH_W")
#! Field("$(P)PRC:GAIN_ILOOP_PH_W.FLNK",16777215,1,"$(P)PRC:GAIN_ILOOP_PH_W.FLNK")
#! Link("$(P)PRC:GAIN_ILOOP_PH_W.FLNK","$(P)CALC_GAIN_ILOOP_RE")
#! Field("$(P)PRC:GAIN_ILOOP_PH_W.VAL",16777215,1,"$(P)PRC:GAIN_ILOOP_PH_W.VAL")
#! Record("$(P)CALC_GAIN_ILOOP_RE",903,448,0,0,"$(P)CALC_GAIN_ILOOP_RE")
#! Field("$(P)CALC_GAIN_ILOOP_RE.INPA",16777215,0,"$(P)CALC_GAIN_ILOOP_RE.INPA")
#! Link("$(P)CALC_GAIN_ILOOP_RE.INPA","$(P)PRC:GAIN_ILOOP_AMP_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_RE.INPB",16777215,0,"$(P)CALC_GAIN_ILOOP_RE.INPB")
#! Link("$(P)CALC_GAIN_ILOOP_RE.INPB","$(P)PRC:GAIN_ILOOP_PH_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_RE.OUT",16777215,0,"$(P)CALC_GAIN_ILOOP_RE.OUT")
#! Link("$(P)CALC_GAIN_ILOOP_RE.OUT","$(P)PRC:GAIN_ILOOP_RE_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_RE.FLNK",16777215,0,"$(P)CALC_GAIN_ILOOP_RE.FLNK")
#! Link("$(P)CALC_GAIN_ILOOP_RE.FLNK","$(P)CALC_GAIN_ILOOP_IM")
#! Record("$(P)CALC_GAIN_ILOOP_IM",863,748,0,0,"$(P)CALC_GAIN_ILOOP_IM")
#! Field("$(P)CALC_GAIN_ILOOP_IM.INPA",16777215,0,"$(P)CALC_GAIN_ILOOP_IM.INPA")
#! Link("$(P)CALC_GAIN_ILOOP_IM.INPA","$(P)PRC:GAIN_ILOOP_AMP_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_IM.INPB",16777215,0,"$(P)CALC_GAIN_ILOOP_IM.INPB")
#! Link("$(P)CALC_GAIN_ILOOP_IM.INPB","$(P)PRC:GAIN_ILOOP_PH_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_IM.OUT",16777215,0,"$(P)CALC_GAIN_ILOOP_IM.OUT")
#! Link("$(P)CALC_GAIN_ILOOP_IM.OUT","$(P)PRC:GAIN_ILOOP_IM_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_IM.FLNK",16777215,1,"$(P)CALC_GAIN_ILOOP_IM.FLNK")
#! Link("$(P)CALC_GAIN_ILOOP_IM.FLNK","$(P)CALC_GAINP_ALPHA")
#! Record("$(P)CALC_GAIN_ILOOP_AMP",48,29,0,0,"$(P)CALC_GAIN_ILOOP_AMP")
#! Field("$(P)CALC_GAIN_ILOOP_AMP.INPA",16777215,1,"$(P)CALC_GAIN_ILOOP_AMP.INPA")
#! Link("$(P)CALC_GAIN_ILOOP_AMP.INPA","$(P)PRC:GAIN_ILOOP_RE_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_AMP.INPB",16777215,1,"$(P)CALC_GAIN_ILOOP_AMP.INPB")
#! Link("$(P)CALC_GAIN_ILOOP_AMP.INPB","$(P)PRC:GAIN_ILOOP_IM_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_AMP.OUT",16777215,1,"$(P)CALC_GAIN_ILOOP_AMP.OUT")
#! Link("$(P)CALC_GAIN_ILOOP_AMP.OUT","$(P)PRC:GAIN_ILOOP_AMP_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_AMP.FLNK",16777215,1,"$(P)CALC_GAIN_ILOOP_AMP.FLNK")
#! Link("$(P)CALC_GAIN_ILOOP_AMP.FLNK","$(P)CALC_GAIN_ILOOP_PH")
#! Record("$(P)CALC_GAIN_ILOOP_PH",883,253,0,0,"$(P)CALC_GAIN_ILOOP_PH")
#! Field("$(P)CALC_GAIN_ILOOP_PH.INPA",16777215,0,"$(P)CALC_GAIN_ILOOP_PH.INPA")
#! Link("$(P)CALC_GAIN_ILOOP_PH.INPA","$(P)PRC:GAIN_ILOOP_RE_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_PH.INPB",16777215,0,"$(P)CALC_GAIN_ILOOP_PH.INPB")
#! Link("$(P)CALC_GAIN_ILOOP_PH.INPB","$(P)PRC:GAIN_ILOOP_IM_W.VAL")
#! Field("$(P)CALC_GAIN_ILOOP_PH.OUT",16777215,0,"$(P)CALC_GAIN_ILOOP_PH.OUT")
#! Link("$(P)CALC_GAIN_ILOOP_PH.OUT","$(P)PRC:GAIN_ILOOP_PH_W.VAL")
#! Record("$(P)PRC:GAIN_ILOOP_RE_W",485,484,0,0,"$(P)PRC:GAIN_ILOOP_RE_W")
#! Field("$(P)PRC:GAIN_ILOOP_RE_W.VAL",16777215,1,"$(P)PRC:GAIN_ILOOP_RE_W.VAL")
#! Field("$(P)PRC:GAIN_ILOOP_RE_W.FLNK",16777215,0,"$(P)PRC:GAIN_ILOOP_RE_W.FLNK")
#! Link("$(P)PRC:GAIN_ILOOP_RE_W.FLNK","$(P)CALC_GAIN_ILOOP_AMP")
#! Record("$(P)PRC:GAIN_ILOOP_IM_W",463,784,0,0,"$(P)PRC:GAIN_ILOOP_IM_W")
#! Field("$(P)PRC:GAIN_ILOOP_IM_W.VAL",16777215,1,"$(P)PRC:GAIN_ILOOP_IM_W.VAL")
#! Field("$(P)PRC:GAIN_ILOOP_IM_W.FLNK",16777215,0,"$(P)PRC:GAIN_ILOOP_IM_W.FLNK")
#! Link("$(P)PRC:GAIN_ILOOP_IM_W.FLNK","$(P)CALC_GAIN_ILOOP_AMP")
#! Record("$(P)PRC:GAINP_AMP_W",823,1524,0,0,"$(P)PRC:GAINP_AMP_W")
#! Field("$(P)PRC:GAINP_AMP_W.FLNK",16777215,1,"$(P)PRC:GAINP_AMP_W.FLNK")
#! Link("$(P)PRC:GAINP_AMP_W.FLNK","$(P)CALC_GAINP_ALPHA")
#! Field("$(P)PRC:GAINP_AMP_W.VAL",16777215,1,"$(P)PRC:GAINP_AMP_W.VAL")
#! Record("$(P)PRC:GAINP_PH_W",843,1045,0,0,"$(P)PRC:GAINP_PH_W")
#! Field("$(P)PRC:GAINP_PH_W.FLNK",16777215,1,"$(P)PRC:GAINP_PH_W.FLNK")
#! Link("$(P)PRC:GAINP_PH_W.FLNK","$(P)CALC_GAINP_ALPHA")
#! Record("$(P)PRC:GAINP_PH_OFFSET_W",803,1632,0,0,"$(P)PRC:GAINP_PH_OFFSET_W")
#! Field("$(P)PRC:GAINP_PH_OFFSET_W.FLNK",16777215,1,"$(P)PRC:GAINP_PH_OFFSET_W.FLNK")
#! Link("$(P)PRC:GAINP_PH_OFFSET_W.FLNK","$(P)CALC_GAINP_ALPHA")
#! Field("$(P)PRC:GAINP_PH_OFFSET_W.VAL",16777215,1,"$(P)PRC:GAINP_PH_OFFSET_W.VAL")
#! Record("$(P)PRC:DDSA_PHSTEP_H_W",2716,978,0,0,"$(P)PRC:DDSA_PHSTEP_H_W")
#! Field("$(P)PRC:DDSA_PHSTEP_H_W.VAL",16777215,1,"$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Field("$(P)PRC:DDSA_PHSTEP_H_W.FLNK",16777215,0,"$(P)PRC:DDSA_PHSTEP_H_W.FLNK")
#! Link("$(P)PRC:DDSA_PHSTEP_H_W.FLNK","$(P)THETA")
#! Record("$(P)THETA",2399,967,0,1,"$(P)THETA")
#! Field("$(P)THETA.INPA",16777215,1,"$(P)THETA.INPA")
#! Link("$(P)THETA.INPA","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Field("$(P)THETA.VAL",16777215,0,"$(P)THETA.VAL")
#! Record("$(P)CALC_GAINP_ALPHA",1123,1040,0,0,"$(P)CALC_GAINP_ALPHA")
#! Field("$(P)CALC_GAINP_ALPHA.INPA",16777215,0,"$(P)CALC_GAINP_ALPHA.INPA")
#! Link("$(P)CALC_GAINP_ALPHA.INPA","$(P)PRC:GAINP_AMP_W.VAL")
#! Field("$(P)CALC_GAINP_ALPHA.INPB",16777215,0,"$(P)CALC_GAINP_ALPHA.INPB")
#! Link("$(P)CALC_GAINP_ALPHA.INPB","$(P)PRC:GAIN_ILOOP_PH_W.VAL")
#! Field("$(P)CALC_GAINP_ALPHA.INPC",16777215,0,"$(P)CALC_GAINP_ALPHA.INPC")
#! Link("$(P)CALC_GAINP_ALPHA.INPC","$(P)PRC:GAINP_PH_OFFSET_W.VAL")
#! Field("$(P)CALC_GAINP_ALPHA.INPD",16777215,1,"$(P)CALC_GAINP_ALPHA.INPD")
#! Link("$(P)CALC_GAINP_ALPHA.INPD","$(P)THETA.VAL")
#! Field("$(P)CALC_GAINP_ALPHA.OUT",16777215,1,"$(P)CALC_GAINP_ALPHA.OUT")
#! Field("$(P)CALC_GAINP_ALPHA.FLNK",16777215,0,"$(P)CALC_GAINP_ALPHA.FLNK")
#! Link("$(P)CALC_GAINP_ALPHA.FLNK","$(P)CALC_GAINP_BETA")
#! Record("$(P)CALC_GAINP_BETA",743,1214,0,1,"$(P)CALC_GAINP_BETA")
#! Field("$(P)CALC_GAINP_BETA.INPA",16777215,1,"$(P)CALC_GAINP_BETA.INPA")
#! Link("$(P)CALC_GAINP_BETA.INPA","$(P)PRC:GAINP_AMP_W.VAL")
#! Field("$(P)CALC_GAINP_BETA.INPB",16777215,0,"$(P)CALC_GAINP_BETA.INPB")
#! Link("$(P)CALC_GAINP_BETA.INPB","$(P)PRC:GAIN_ILOOP_PH_W.VAL")
#! Field("$(P)CALC_GAINP_BETA.INPC",16777215,1,"$(P)CALC_GAINP_BETA.INPC")
#! Link("$(P)CALC_GAINP_BETA.INPC","$(P)PRC:GAINP_PH_OFFSET_W.VAL")
#! Field("$(P)CALC_GAINP_BETA.INPD",16777215,1,"$(P)CALC_GAINP_BETA.INPD")
#! Link("$(P)CALC_GAINP_BETA.INPD","$(P)THETA.VAL")
#! Field("$(P)CALC_GAINP_BETA.OUT",16777215,1,"$(P)CALC_GAINP_BETA.OUT")
#! Record("$(P)BT_CLOSELOOP",1447,123,0,0,"$(P)BT_CLOSELOOP")
#! Field("$(P)BT_CLOSELOOP.FLNK",16777215,0,"$(P)BT_CLOSELOOP.FLNK")
#! Link("$(P)BT_CLOSELOOP.FLNK","$(P)CALC_CLOSELOOP")
#! Field("$(P)BT_CLOSELOOP.VAL",16777215,0,"$(P)BT_CLOSELOOP.VAL")
#! Record("$(P)CALC_CLOSELOOP",1442,286,0,0,"$(P)CALC_CLOSELOOP")
#! Field("$(P)CALC_CLOSELOOP.INPA",16777215,0,"$(P)CALC_CLOSELOOP.INPA")
#! Link("$(P)CALC_CLOSELOOP.INPA","$(P)BT_CLOSELOOP.VAL")
#! Field("$(P)CALC_CLOSELOOP.FLNK",16777215,0,"$(P)CALC_CLOSELOOP.FLNK")
#! Link("$(P)CALC_CLOSELOOP.FLNK","$(P)SWITCH_CLOSELOOP")
#! Field("$(P)CALC_CLOSELOOP.VAL",16777215,0,"$(P)CALC_CLOSELOOP.VAL")
#! Record("$(P)SWITCH_CLOSELOOP",1442,461,0,0,"$(P)SWITCH_CLOSELOOP")
#! Field("$(P)SWITCH_CLOSELOOP.SELL",16777215,0,"$(P)SWITCH_CLOSELOOP.SELL")
#! Link("$(P)SWITCH_CLOSELOOP.SELL","$(P)CALC_CLOSELOOP.VAL")
#! Field("$(P)SWITCH_CLOSELOOP.LNK1",16777215,0,"$(P)SWITCH_CLOSELOOP.LNK1")
#! Link("$(P)SWITCH_CLOSELOOP.LNK1","$(P)DO_OPENLOOP.VAL")
#! Field("$(P)SWITCH_CLOSELOOP.LNK2",16777215,1,"$(P)SWITCH_CLOSELOOP.LNK2")
#! Link("$(P)SWITCH_CLOSELOOP.LNK2","$(P)DO_CLOSELOOP.VAL")
#! Record("$(P)DO_CLOSELOOP",1697,707,0,0,"$(P)DO_CLOSELOOP")
#! Field("$(P)DO_CLOSELOOP.VAL",16777215,1,"$(P)DO_CLOSELOOP.VAL")
#! Field("$(P)DO_CLOSELOOP.DOL1",16777215,1,"$(P)DO_CLOSELOOP.DOL1")
#! Link("$(P)DO_CLOSELOOP.DOL1","$(P)PRC:CALC_FDBK_CLIPV_W.VAL")
#! Field("$(P)DO_CLOSELOOP.DOL2",16777215,0,"$(P)DO_CLOSELOOP.DOL2")
#! Field("$(P)DO_CLOSELOOP.DOL3",16777215,0,"$(P)DO_CLOSELOOP.DOL3")
#! Field("$(P)DO_CLOSELOOP.LNK4",16777215,1,"$(P)DO_CLOSELOOP.LNK4")
#! Field("$(P)DO_CLOSELOOP.LNK5",16777215,1,"$(P)DO_CLOSELOOP.LNK5")
#! Record("$(P)PRC:CALC_FDBK_CLIPV_W",1974,724,0,0,"$(P)PRC:CALC_FDBK_CLIPV_W")
#! Field("$(P)PRC:CALC_FDBK_CLIPV_W.VAL",16777215,0,"$(P)PRC:CALC_FDBK_CLIPV_W.VAL")
#! Field("$(P)PRC:CALC_FDBK_CLIPV_W.INPA",16777215,1,"$(P)PRC:CALC_FDBK_CLIPV_W.INPA")
#! Field("$(P)PRC:CALC_FDBK_CLIPV_W.OUT",16777215,1,"$(P)PRC:CALC_FDBK_CLIPV_W.OUT")
#! Record("$(P)DO_OPENLOOP",1368,695,0,0,"$(P)DO_OPENLOOP")
#! Field("$(P)DO_OPENLOOP.VAL",16777215,0,"$(P)DO_OPENLOOP.VAL")
#! Field("$(P)DO_OPENLOOP.LNK1",16777215,1,"$(P)DO_OPENLOOP.LNK1")
#! Field("$(P)DO_OPENLOOP.LNK4",16777215,1,"$(P)DO_OPENLOOP.LNK4")
#! Field("$(P)DO_OPENLOOP.LNK5",16777215,1,"$(P)DO_OPENLOOP.LNK5")
#! Record("$(P)CALC_OPEN_SOURCE_RE",986,116,0,0,"$(P)CALC_OPEN_SOURCE_RE")
#! Field("$(P)CALC_OPEN_SOURCE_RE.INPA",16777215,1,"$(P)CALC_OPEN_SOURCE_RE.INPA")
#! Record("$(P)PRC:ADC1_MIN_R",3059,1315,0,0,"$(P)PRC:ADC1_MIN_R")
#! Field("$(P)PRC:ADC1_MIN_R.VAL",16777215,1,"$(P)PRC:ADC1_MIN_R.VAL")
#! Record("$(P)PRC:ADC2_MIN_R",3299,1315,0,0,"$(P)PRC:ADC2_MIN_R")
#! Field("$(P)PRC:ADC2_MIN_R.VAL",16777215,1,"$(P)PRC:ADC2_MIN_R.VAL")
#! Record("$(P)PRC:ADC3_MIN_R",3539,1315,0,0,"$(P)PRC:ADC3_MIN_R")
#! Field("$(P)PRC:ADC3_MIN_R.VAL",16777215,0,"$(P)PRC:ADC3_MIN_R.VAL")
#! Record("$(P)PRC:ADC4_MIN_R",3779,1315,0,0,"$(P)PRC:ADC4_MIN_R")
#! Field("$(P)PRC:ADC4_MIN_R.VAL",16777215,1,"$(P)PRC:ADC4_MIN_R.VAL")
#! Record("$(P)PRC:ADC1_MAX_R",3059,1555,0,0,"$(P)PRC:ADC1_MAX_R")
#! Field("$(P)PRC:ADC1_MAX_R.VAL",16777215,1,"$(P)PRC:ADC1_MAX_R.VAL")
#! Record("$(P)PRC:ADC2_MAX_R",3299,1555,0,0,"$(P)PRC:ADC2_MAX_R")
#! Field("$(P)PRC:ADC2_MAX_R.VAL",16777215,1,"$(P)PRC:ADC2_MAX_R.VAL")
#! Record("$(P)PRC:ADC3_MAX_R",3539,1555,0,0,"$(P)PRC:ADC3_MAX_R")
#! Field("$(P)PRC:ADC3_MAX_R.VAL",16777215,0,"$(P)PRC:ADC3_MAX_R.VAL")
#! Record("$(P)PRC:ADC4_MAX_R",3779,1555,0,0,"$(P)PRC:ADC4_MAX_R")
#! Field("$(P)PRC:ADC4_MAX_R.VAL",16777215,1,"$(P)PRC:ADC4_MAX_R.VAL")
#! Record("$(P)PRC:DECAY_SAMP_PER_W",3059,1775,0,0,"$(P)PRC:DECAY_SAMP_PER_W")
#! Field("$(P)PRC:DECAY_SAMP_PER_W.VAL",16777215,1,"$(P)PRC:DECAY_SAMP_PER_W.VAL")
#! Record("$(P)PRC:CH_KEEP_W",3299,1775,0,0,"$(P)PRC:CH_KEEP_W")
#! Field("$(P)PRC:CH_KEEP_W.VAL",16777215,1,"$(P)PRC:CH_KEEP_W.VAL")
#! Record("$(P)SYSTEM_HEALTH_1",3619,809,0,0,"$(P)SYSTEM_HEALTH_1")
#! Field("$(P)SYSTEM_HEALTH_1.INPA",16777215,0,"$(P)SYSTEM_HEALTH_1.INPA")
#! Link("$(P)SYSTEM_HEALTH_1.INPA","$(P)PRC:ADC1_MAX_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPB",16777215,0,"$(P)SYSTEM_HEALTH_1.INPB")
#! Link("$(P)SYSTEM_HEALTH_1.INPB","$(P)PRC:ADC2_MAX_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPC",16777215,0,"$(P)SYSTEM_HEALTH_1.INPC")
#! Link("$(P)SYSTEM_HEALTH_1.INPC","$(P)PRC:ADC3_MAX_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPD",16777215,1,"$(P)SYSTEM_HEALTH_1.INPD")
#! Link("$(P)SYSTEM_HEALTH_1.INPD","$(P)PRC:ADC4_MAX_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPE",16777215,0,"$(P)SYSTEM_HEALTH_1.INPE")
#! Link("$(P)SYSTEM_HEALTH_1.INPE","$(P)PRC:ADC1_MIN_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPF",16777215,0,"$(P)SYSTEM_HEALTH_1.INPF")
#! Link("$(P)SYSTEM_HEALTH_1.INPF","$(P)PRC:ADC2_MIN_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPG",16777215,0,"$(P)SYSTEM_HEALTH_1.INPG")
#! Link("$(P)SYSTEM_HEALTH_1.INPG","$(P)PRC:ADC3_MIN_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPH",16777215,1,"$(P)SYSTEM_HEALTH_1.INPH")
#! Link("$(P)SYSTEM_HEALTH_1.INPH","$(P)PRC:ADC4_MIN_R.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPI",16777215,0,"$(P)SYSTEM_HEALTH_1.INPI")
#! Link("$(P)SYSTEM_HEALTH_1.INPI","$(P)PRC:DECAY_SAMP_PER_W.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPJ",16777215,0,"$(P)SYSTEM_HEALTH_1.INPJ")
#! Link("$(P)SYSTEM_HEALTH_1.INPJ","$(P)PRC:CH_KEEP_W.VAL")
#! Field("$(P)SYSTEM_HEALTH_1.INPK",16777215,0,"$(P)SYSTEM_HEALTH_1.INPK")
#! Link("$(P)SYSTEM_HEALTH_1.INPK","$(P)PRC:DDSA_PHSTEP_H_W.VAL")
#! Record("$(P)RF_MASTER",2319,35,0,0,"$(P)RF_MASTER")
#! Field("$(P)RF_MASTER.VAL",16777215,1,"$(P)RF_MASTER.VAL")
#! Field("$(P)RF_MASTER.FLNK",16777215,0,"$(P)RF_MASTER.FLNK")
#! Link("$(P)RF_MASTER.FLNK","$(P)BOUNDARY_RESET_CALC")
#! Record("$(P)MASK_BOUNDARY_RESET",2234,516,0,0,"$(P)MASK_BOUNDARY_RESET")
#! Field("$(P)MASK_BOUNDARY_RESET.VAL",16777215,0,"$(P)MASK_BOUNDARY_RESET.VAL")
#! Record("$(P)BOUNDARY_RESET_CALC",2234,145,0,0,"$(P)BOUNDARY_RESET_CALC")
#! Field("$(P)BOUNDARY_RESET_CALC.INPA",16777215,1,"$(P)BOUNDARY_RESET_CALC.INPA")
#! Link("$(P)BOUNDARY_RESET_CALC.INPA","$(P)RF_MASTER.VAL")
#! Field("$(P)BOUNDARY_RESET_CALC.INPB",16777215,1,"$(P)BOUNDARY_RESET_CALC.INPB")
#! Field("$(P)BOUNDARY_RESET_CALC.INPE",16777215,1,"$(P)BOUNDARY_RESET_CALC.INPE")
#! Field("$(P)BOUNDARY_RESET_CALC.INPF",16777215,1,"$(P)BOUNDARY_RESET_CALC.INPF")
#! Field("$(P)BOUNDARY_RESET_CALC.OUT",16777215,1,"$(P)BOUNDARY_RESET_CALC.OUT")
#! Field("$(P)BOUNDARY_RESET_CALC.SDIS",16777215,0,"$(P)BOUNDARY_RESET_CALC.SDIS")
#! Link("$(P)BOUNDARY_RESET_CALC.SDIS","$(P)MASK_BOUNDARY_RESET.VAL")
