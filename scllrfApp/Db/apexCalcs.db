record(calcout,"$(P)$(R):laser_freq_Hz")
{
	field(INPA,"$(P)$(R):laser_freq")
	field(INPB,"-13.6239")
	field(CALC,"A*B")
}
record(ai,"float64_test")
{
    field(DTYP, "asynFloat64")
    field(INP,  "@asyn(portasyn 8 0)")
    field(SCAN, "1 second")
}
#record(stringin,"string_test")
#{
#    field(DTYP, "asynOctetRead")
#    field(INP,  "@asyn(portasyn 8 0) None")
#    field(SCAN, "1 second")
#}
record(ao,"$(P)$(R):wave_samp_per_ao")
{
	field(FLNK, "$(P)$(R):wave_shift_calc")
}
record(calcout,"$(P)$(R):wave_shift_calc")
{
    field(INPA,"$(P)$(R):wave_samp_per_ao")
	field(INPB,"0.602059991327962") #log10(4)
# change by hg for 100MHz -> 102MHz Osc CIC_PERIOD change from 14 to 22
#	field(INPC,"5349.87755102041") #2^20/(14^2)
	field(INPC,"2166.479338842975") #2^20/(22^2)
    field(CALC,"MIN(8-FLOOR(LOG(C/A^2)/B),7)")
    field(OUT, "$(P)$(R):wave_shift_ao PP")
}

record(ao,"$(P)$(R):ph2_4_static")
{

}
record(calcout,"$(P)$(R):phase_diff")
{
	field(INPA,"$(P)$(R):ph2_4_mean")
	field(INPB,"$(P)$(R):ph2_4_static PP")
	field(INPC,"8.38190317153931e-08")
	field(INPD,"360000")
# 360/2^32
	field(CALC,"((((A*C-B+540)*1000)%D)/1000-180)")
	field(SCAN,".2 second")
}
record(bo,"$(P)$(R):freq_loop_close")
{
}
record(ao,"$(P)$(R):freq_loop_gain")
{
#       field(FLNK, "$(P)$(R):freq_shift")
        field(VAL,"0.2")
}

record(calcout,"$(P)$(R):freq_shift")
{
	field(INPA,"$(P)$(R):ddsa_phstep_h_ao")
	field(INPB,"$(P)$(R):phase_diff")
	field(INPC,"$(P)$(R):rf_master")
	field(INPD,"$(P)$(R):freq_loop_close PP")
        field(INPE,"$(P)$(R):freq_loop_gain PP")
        field(CALC,"(A+(ABS(B)<40?B:0)*E*C*D)")
	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):ddsa_phstep_h_ao PP")
}
record(calc,"$(P)$(R):freq_cav")
{
	field(INPA,"$(P)$(R):ddsa_phstep_h_ao")
	field(INPB,"$(P)$(R):ddsa_phstep_l_ao")
	field(INPC,"$(P)$(R):ddsa_modulo_ao")
	field(CALC,"102.143*(2-(A+B/(4096-C))/2^20)")
	field(SCAN,"1 second")
}
record(calcout,"$(P)$(R):detune_good")
{
	field(INPA,"$(P)$(R):decay_strength")
	field(INPB,"$(P)$(R):decay_fit_stddev")
	field(INPC,"10000")
	field(INPD,"3000")
	field(CALC,"(A>C)&&(B<D)")
	field(SCAN,"1 second")
}
record(calcout,"$(P)$(R):calc_new_phstep_h")
{
	field(INPA,"$(P)$(R):ddsa_phstep_h_ao")
	field(INPB,"$(P)$(R):decay_constant_b")
	field(INPC,"1.0265779e-5")             # 2^20/(1300e6/7*11/20)/1000
	field(CALC,"A-B*C")
}
record(ai,"$(P)$(R):ph2_4_mean")
{
	field(FLNK,"$(P)$(R):ph2_4_mean_degree")
}
record(calcout,"$(P)$(R):ph2_4_mean_degree")
{
	field(INPA,"$(P)$(R):ph2_4_mean")
	field(INPB,"8.38190317153931e-08")      #360/2^32
	field(CALC,"A*B")
}
record(calcout,"$(P)$(R):ready_to_tune")
{
	field(INPA,"$(P)$(R):detune_good")
	field(INPB,"$(P)$(R):freq_loop_close")
	field(CALC,"(A==1)&(B==0)")
}
record(bo,"$(P)$(R):bt_do_freq_correction")
{
	field(FLNK,"$(P)$(R):do_freq_correction")
	field(ZNAM,"Off")
	field(ONAM,"On")
}

record(seq,"$(P)$(R):do_freq_correction")
{
	field(SELL,"$(P)$(R):ready_to_tune")
	field(SELM,"All")

    field(DOL1,"$(P)$(R):calc_new_phstep_h PP")
    field(LNK1,"$(P)$(R):ddsa_phstep_h_ao PP")

    field(DOL2,"$(P)$(R):ph2_4_mean_degree PP")
    field(LNK2,"$(P)$(R):ph2_4_static PP")
    field(DLY2,"1")
}
#record(ao,"$(P)$(R):pulse_length_ao")
#{
#    field(LINR, “SLOPE”)
#    field(ESLO, “9.790209e-3”)
#    field(EGU,  “uS”)
#}
record(ao,"$(P)$(R):source_amp_ao")
{
	field(FLNK,"$(P)$(R):calc_source_re PP")
}
record(ao,"$(P)$(R):source_ph_ao")
{	
	field(PREC, 4)
	field(FLNK,"$(P)$(R):calc_source_re PP")
}
record(calcout,"$(P)$(R):calc_source_re")
{
	field(INPA,"$(P)$(R):source_amp_ao")
	field(INPB,"$(P)$(R):source_ph_ao")
        field(CALC,"(A*COS(B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):source_re_ao PP")
	field(FLNK,"$(P)$(R):calc_source_im PP")
}
record(calcout,"$(P)$(R):calc_source_im")
{
	field(INPA,"$(P)$(R):source_amp_ao")
	field(INPB,"$(P)$(R):source_ph_ao")
        field(CALC,"(A*SIN(B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):source_im_ao PP")
	field(FLNK,"$(P)$(R):calc_set_iloop_re PP")
}

record(calcout,"$(P)$(R):calc_source_amp")
{
	field(INPA,"$(P)$(R):source_re_ao")
	field(INPB,"$(P)$(R):source_im_ao")
        field(CALC,"(SQRT(A*A+B*B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
# Value pushed to source_amp_ao, but don't process it!
# That would create an infinite processing loop.
	field(OUT,"$(P)$(R):source_amp_ao NPP")
	field(FLNK,"$(P)$(R):calc_source_ph PP")
	field(PINI,1)
}
record(calcout,"$(P)$(R):calc_source_ph")
{
	field(INPA,"$(P)$(R):source_re_ao")
	field(INPB,"$(P)$(R):source_im_ao")
        field(CALC,"(ATAN2(A,B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):source_ph_ao NPP")
	field(PINI,1)
}
record(ao,"$(P)$(R):source_re_ao")
{
	field(FLNK,"$(P)$(R):calc_source_amp PP")
}
record(ao,"$(P)$(R):source_im_ao")
{
	field(FLNK,"$(P)$(R):calc_source_amp PP")
}


#record(ao,"$(P)$(R):set_iloop_amp_ao")
#{
#	field(FLNK,"$(P)$(R):calc_set_iloop_re PP")
#}
#record(ao,"$(P)$(R):set_iloop_ph_ao")
#{	
#	field(PREC, 4)
#	field(FLNK,"$(P)$(R):calc_set_iloop_re PP")
#}
#record(calcout,"$(P)$(R):calc_set_iloop_re")
#{
#	field(INPA,"$(P)$(R):set_iloop_amp_ao")
#	field(INPB,"$(P)$(R):set_iloop_ph_ao")
#        field(CALC,"(A*COS(B))")
##	field(SCAN,".2 second")
##	field(TPRO,1)
#	field(OUT,"$(P)$(R):set_iloop_re_ao PP")
#	field(FLNK,"$(P)$(R):calc_set_iloop_im PP")
#}
#record(calcout,"$(P)$(R):calc_set_iloop_im")
#{
#	field(INPA,"$(P)$(R):set_iloop_amp_ao")
#	field(INPB,"$(P)$(R):set_iloop_ph_ao")
#        field(CALC,"(A*SIN(B))")
##	field(SCAN,".2 second")
##	field(TPRO,1)
#	field(OUT,"$(P)$(R):set_iloop_im_ao PP")
#}

record(calcout,"$(P)$(R):calc_set_iloop_amp")
{
	field(INPA,"$(P)$(R):set_iloop_re_ao")
	field(INPB,"$(P)$(R):set_iloop_im_ao")
        field(CALC,"(SQRT(A*A+B*B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):set_iloop_amp_ao NPP")
	field(FLNK,"$(P)$(R):calc_set_iloop_ph PP")
	field(PINI,1)
}
record(calcout,"$(P)$(R):calc_set_iloop_ph")
{
	field(INPA,"$(P)$(R):set_iloop_re_ao")
	field(INPB,"$(P)$(R):set_iloop_im_ao")
        field(CALC,"(ATAN2(A,B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):set_iloop_ph_ao NPP")
	field(FLNK,"$(P)$(R):calc_set_ploop_re")
	field(PINI,1)
}
record(ao,"$(P)$(R):set_iloop_re_ao")
{
	field(FLNK,"$(P)$(R):calc_set_iloop_amp PP")
}
record(ao,"$(P)$(R):set_iloop_im_ao")
{
	field(FLNK,"$(P)$(R):calc_set_iloop_amp PP")
}


record(ao,"$(P)$(R):gain_iloop_amp_ao")
{
	field(FLNK,"$(P)$(R):calc_gain_iloop_re PP")
}
record(ao,"$(P)$(R):gain_iloop_ph_ao")
{	
	field(PREC, 4)
	field(FLNK,"$(P)$(R):calc_gain_iloop_re PP")
}
record(calcout,"$(P)$(R):calc_gain_iloop_re")
{
	# attached to hardware register
	field(INPA,"$(P)$(R):gain_iloop_amp_ao")
	field(INPB,"$(P)$(R):gain_iloop_ph_ao")
        field(CALC,"(A*COS(B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):gain_iloop_re_ao PP")
	field(FLNK,"$(P)$(R):calc_gain_iloop_im PP")
}
record(calcout,"$(P)$(R):calc_gain_iloop_im")
{
	# attached to hardware register
	field(INPA,"$(P)$(R):gain_iloop_amp_ao")
	field(INPB,"$(P)$(R):gain_iloop_ph_ao")
        field(CALC,"(A*SIN(B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):gain_iloop_im_ao PP")
	field(FLNK,"$(P)$(R):calc_gainp_alpha PP")
}

record(calcout,"$(P)$(R):calc_gain_iloop_amp")
{
	field(INPA,"$(P)$(R):gain_iloop_re_ao")
	field(INPB,"$(P)$(R):gain_iloop_im_ao")
        field(CALC,"(SQRT(A*A+B*B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):gain_iloop_amp_ao NPP")
	field(FLNK,"$(P)$(R):calc_gain_iloop_ph PP")
	field(PINI,1)
}
record(calcout,"$(P)$(R):calc_gain_iloop_ph")
{
	field(INPA,"$(P)$(R):gain_iloop_re_ao")
	field(INPB,"$(P)$(R):gain_iloop_im_ao")
        field(CALC,"(ATAN2(A,B))")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):gain_iloop_ph_ao NPP")
	field(PINI,1)
}
record(ao,"$(P)$(R):gain_iloop_re_ao")
{
	field(FLNK,"$(P)$(R):calc_gain_iloop_amp PP")
}
record(ao,"$(P)$(R):gain_iloop_im_ao")
{
	field(FLNK,"$(P)$(R):calc_gain_iloop_amp PP")
}


record(ao,"$(P)$(R):gainp_amp_ao")
{
	field(FLNK,"$(P)$(R):calc_gainp_alpha PP")
}
record(ao,"$(P)$(R):gainp_ph_ao")
{	
	field(PREC, 4)
	field(FLNK,"$(P)$(R):calc_gainp_alpha PP")
}
record(ao,"$(P)$(R):gainp_ph_offset_ao")
{	
	field(PREC, 4)
	field(FLNK,"$(P)$(R):calc_gainp_alpha PP")
	field(VAL, -0.772)  # determined by simulation, see close_loop_proc.py
	field(PINI,1)
}
record(ao,"$(P)$(R):ddsa_phstep_h_ao")
{
	field(FLNK,"$(P)$(R):theta")
}
record(calc,"$(P)$(R):theta")
{
	field(PREC, 4)
	field(INPA,"$(P)$(R):ddsa_phstep_h_ao CA")
	field(INPB,1048576)
	field(CALC,"A/B*2*PI")
	
}
record(calcout,"$(P)$(R):calc_gainp_alpha")
{
	field(PREC, 4)
	field(INPA,"$(P)$(R):gainp_amp_ao PP")
	field(INPB,"$(P)$(R):gain_iloop_ph_ao")
	field(INPC,"$(P)$(R):gainp_ph_offset_ao")
	field(INPD,"$(P)$(R):theta PP")
        field(CALC,"(A*COS(B+C))-COS(D)/SIN(D)*A*SIN(B+C)")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):gainp_alpha_ao PP")
	field(FLNK,"$(P)$(R):calc_gainp_beta PP")
}
record(calcout,"$(P)$(R):calc_gainp_beta")
{
	field(INPA,"$(P)$(R):gainp_amp_ao")
	field(INPB,"$(P)$(R):gain_iloop_ph_ao")
	field(INPC,"$(P)$(R):gainp_ph_offset_ao")
	field(INPD,"$(P)$(R):theta")
        field(CALC,"(A*SIN(B+C))/SIN(D)")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):gainp_beta_ao PP")
}

#record(calcout,"$(P)$(R):calc_gainp_amp")
#{
#	field(INPA,"$(P)$(R):gainp_alpha_ao")
#	field(INPB,"$(P)$(R):gainp_beta_ao")
#        field(CALC,"(SQRT(A*A+B*B))")
##	field(SCAN,".2 second")
##	field(TPRO,1)
#	field(OUT,"$(P)$(R):gainp_amp_ao NPP")
#	field(FLNK,"$(P)$(R):calc_gainp_ph PP")
#	field(PINI,1)
#}
#record(calcout,"$(P)$(R):calc_gainp_ph")
#{
#	field(INPA,"$(P)$(R):gainp_alpha_ao")
#	field(INPB,"$(P)$(R):gainp_beta_ao")
#        field(CALC,"(ATAN2(A,B))")
##	field(SCAN,".2 second")
##	field(TPRO,1)
#	field(OUT,"$(P)$(R):gainp_ph_ao NPP")
#	field(PINI,1)
#}
#record(ao,"$(P)$(R):gainp_alpha_ao")
#{
#	field(FLNK,"$(P)$(R):calc_gainp_amp")
#}
#record(ao,"$(P)$(R):gainp_beta_ao")
#{
#	field(FLNK,"$(P)$(R):calc_gainp_amp")
#}


record(calcout,"$(P)$(R):calc_set_iloop_re")
{
	field(INPA,"$(P)$(R):set_ploop_re_ao")
	field(INPB,"$(P)$(R):set_ploop_im_ao")
	field(INPC,"-3.1018")
	field(INPD,"2.7558")
	field(INPE,"131071")
    field(CALC,"MIN(MAX(FLOOR(A*C-B*D+0.5),-E),E)")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):set_iloop_re_ao PP")
	field(FLNK,"$(P)$(R):calc_set_iloop_im PP")
}
record(calcout,"$(P)$(R):calc_set_iloop_im")
{
	field(INPA,"$(P)$(R):set_ploop_re_ao")
	field(INPB,"$(P)$(R):set_ploop_im_ao")
	field(INPC,"-3.1018")
	field(INPD,"2.7558")
	field(INPE,"131071")
    field(CALC,"MIN(MAX(FLOOR(A*D+B*C+0.5),-E),E)")
#	field(SCAN,".2 second")
#	field(TPRO,1)
	field(OUT,"$(P)$(R):set_iloop_im_ao PP")
}

record(bo,"$(P)$(R):bt_closeloop")
{
        field(FLNK,"$(P)$(R):calc_closeloop")
        field(ZNAM,"Off")
        field(ONAM,"On")
        field(TPRO,1)
}


record(calc,"$(P)$(R):calc_closeloop")
{
	field(INPA,"$(P)$(R):bt_closeloop")
	field(FLNK,"$(P)$(R):switch_closeloop")
	field(CALC,"A?2:1")
	field(TPRO,1)
}
record(seq,"$(P)$(R):switch_closeloop")
{
	field(SELM,"Specified")
	#field(SELM,"All")
	field(SELL,"$(P)$(R):calc_closeloop")
	field(LNK1, "$(P)$(R):do_openloop PP")
	field(LNK2, "$(P)$(R):do_closeloop PP")
	field(TPRO,1)
}

record(seq,"$(P)$(R):do_closeloop")
{
	field(SELM,"All")
	field(DOL1,"$(P)$(R):calc_fdbk_clipv_ao PP")
#	field(LNK1,"$(P)$(R):fdbk_clipv_ao PP")
#    	field(DLY1,"1")

#	field(DOL2,"$(P)$(R):calc_set_ploop_re PP")
	field(DOL2,"$(P)$(R):calc_loop_set_iloop_re PP")
#	field(LNK2,"$(P)$(R):set_ploop_re_ao PP")
#	field(DOL3,"$(P)$(R):calc_set_ploop_im PP")
	field(DOL3,"$(P)$(R):calc_loop_set_iloop_im PP")
#	field(LNK3,"$(P)$(R):set_ploop_im_ao PP")
#	field(DLY3,"1")
	field( DO4,"1")
	field(LNK4,"$(P)$(R):int_ena_bo PP")
	field(DLY4,"1")
	field( DO5,"1")
	field(LNK5,"$(P)$(R):close_loop_bo PP")
	field(DLY5,"1")
	field(TPRO,1)
}
record(calcout,"$(P)$(R):calc_fdbk_clipv_ao")
{
	field(INPA,"$(P)$(R):source_amp_ao PP")
	field(B, 32767)
        field(CALC,"max(-B,min(1.15*A,B))")
	field(OUT,"$(P)$(R):fdbk_clipv_ao PP")
	field(TPRO,1)
}

record(calcout,"$(P)$(R):calc_set_ploop_re")
{
	field(INPA,"$(P)$(R):set_iloop_re_ao")
	field(INPB,"$(P)$(R):set_iloop_im_ao")
	field(C, -0.180174 )
	field(D, -0.160076 )
	field(E, 32767)
        field(CALC,"max(-E,min(E,A*C-B*D))")
	field(OUT,"$(P)$(R):set_ploop_re_ao PP")
	field(TPRO,1)
	field(FLNK,"$(P)$(R):calc_set_ploop_im")
}
record(calcout,"$(P)$(R):calc_set_ploop_im")
{
	field(INPA,"$(P)$(R):set_iloop_re_ao")
	field(INPB,"$(P)$(R):set_iloop_im_ao")
	field(C, -0.180174 )
	field(D, -0.160076 )
	field(E, 32767)
        field(CALC,"max(-E,min(E,A*D+B*C))")
	field(OUT,"$(P)$(R):set_ploop_im_ao PP")
	field(TPRO,1)
}
# acalcout record is not working as expected
#record(acalcout,"$(P)$(R):w7_avr")
#{
#	field(INAA,"$(P)$(R):w7")
#	#field(CALC,"AVG(AA[400,600])")
#	field(CALC,"AVG(AA)")
#	field(TPRO,1)
#}
#record(acalcout,"$(P)$(R):w8_avr")
#{
#	field(INAA,"$(P)$(R):w8")
#	field(CALC,"AVG(AA)")
#	field(TPRO,1)
#}
record(calcout,"$(P)$(R):calc_loop_set_iloop_re")
{
	field(INPA,"$(P)$(R):w7_mean PP")
	field(INPB,"$(P)$(R):yscale PP")
	field(C,"123904") #"22*22/512.0*2**17"
	field(D,"131071")
	field(CALC,"max(-D,min(D,A*C/B))")
	field(OUT,"$(P)$(R):set_iloop_re_ao PP")
	field(TPRO,1)
	field(FLNK,"$(P)$(R):calc_loop_set_iloop_im")
}
record(calcout,"$(P)$(R):calc_loop_set_iloop_im")
{
	field(INPA,"$(P)$(R):w8_mean PP")
	field(INPB,"$(P)$(R):yscale PP")
	field(C,"123904") #"22*22/512.0*2**17"
	field(D,"131071")
	field(CALC,"A*C/B")
	field(OUT,"$(P)$(R):set_iloop_im_ao PP")
	field(TPRO,1)
#	field(FLNK,"$(P)$(R):calc_set_ploop_re")
}

record(seq,"$(P)$(R):do_openloop")
{
	field(SELM,"All")
	field( DO1,"0")
	field(LNK1,"$(P)$(R):fdbk_clipv_ao PP")
#	field( DO2,"0")
#	field(LNK2,"$(P)$(R):source_re_ao PP")
#	field( DO3,"0")
#	field(LNK3,"$(P)$(R):source_im_ao PP")
	field( DO4,"0")
	field(LNK4,"$(P)$(R):close_loop_bo PP")
	field( DO5,"0")
	field(LNK5,"$(P)$(R):int_ena_bo PP")
	field(DLY5,"0")
#	field(DOL6,"$(P)$(R):calc_open_source_re_ao PP")
#	field(LNK6,"$(P)$(R):source_re_ao PP")
#	field(DO7, "0")
#	field(LNK7,"$(P)$(R):source_im_ao PP")
	field(DLY7,"1")
	field(TPRO,1)
}

record(calc,"$(P)$(R):calc_open_source_re_ao")
{
	field(INPA,"$(P)$(R):fdbk_clipv_ao")
	field(CALC,"floor(A/1.15+0.5)")
	field(TPRO,1)
}

record(ai,"$(P)$(R):adc1_min")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc2_min")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc3_min")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc4_min")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc1_max")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc2_max")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc3_max")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ai,"$(P)$(R):adc4_max")
{
	field(HIHI,"32700")
	field(HIGH,"32500")
	field(LOW,"-32500")
	field(LOLO,"-32700")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ao,"$(P)$(R):decay_samp_per_ao")
{
	field(HIHI,"4")
	field(HIGH,"3")
	field(LOW,"1")
	field(LOLO,"0")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(ao,"$(P)$(R):ch_keep_ao")
{
	field(HIHI,"4081")
	field(HIGH,"4081")
	field(LOW,"4079")
	field(LOLO,"4079")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}
record(calc, "$(P)$(R):system_health_1")
{
	field(INPA,"$(P)$(R):adc1_max CP MS")
	field(INPB,"$(P)$(R):adc2_max CP MS")
	field(INPC,"$(P)$(R):adc3_max CP MS")
	field(INPD,"$(P)$(R):adc4_max CP MS")
	field(INPE,"$(P)$(R):adc1_min CP MS")
	field(INPF,"$(P)$(R):adc2_min CP MS")
	field(INPG,"$(P)$(R):adc3_min CP MS")
	field(INPH,"$(P)$(R):adc4_min CP MS")
	field(INPI,"$(P)$(R):decay_samp_per_ao CP MS")
	field(INPJ,"$(P)$(R):ch_keep_ao CP MS")
	field(INPK,"$(P)$(R):ddsa_phstep_h_ao CP MS")
#	field(SCAN,"1 second")
}
record(ao,"$(P)$(R):ddsa_phstep_h_ao")
{
	# round((2/11+[-0.3 -0.2 0.4 0.5]/102.14)*2^20)
	field(HIHI,"195783.0")
	field(HIGH,"194757.0")
	field(LOW, "188597.0")
	field(LOLO,"187570.0")
	field(HHSV,"MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV,"MAJOR")
}

#record(calc, "$(P)$(R):system_health_cmp_1")
#{
#	field(INPA, "$(P)$(R):decay_samp_per_ao")
#}

record(ai,"$(P)$(R):rf_master")
{
#Garth adding the desrciption
	field(DESC, "Master control to enable/disable RF"
	field(FLNK,"$(P)$(R):boundary_reset_calc")
}

record(ao,"$(P)$(R):mask_boundary_reset")
{
}

record(calcout,"$(P)$(R):boundary_reset_calc")
{
	field(INPA,"llrf1:rf_master")
	field(INPB,"$(P)$(R):rf_go_bo")
	field(INPC,"$(P)$(R):mask_boundary_reset")
	field(INPD,"$(P)$(R):pulse_boundary_ao PP")
	field(INPE,"llrf1:rep_period_ao")
	field(INPF,"llrf1:pulse_length_ao")
        field(CALC,"C?D:((A&&(F<E))?2:0)")
    	field(OUT, "$(P)$(R):pulse_boundary_ao PP")
	field(SCAN,"1 second")
}
